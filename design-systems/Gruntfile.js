'use strict';

//--------------------------------------------------------------------------------------------------------------------------------------------------------------
//
//                                                         ████████╗  █████╗  ██╗      ██╗  ██╗ ███████╗
//                                                         ╚══██╔══╝ ██╔══██╗ ██║      ██║ ██╔╝ ██╔════╝
//                                                            ██║    ███████║ ██║      █████╔╝  ███████╗
//                                                            ██║    ██╔══██║ ██║      ██╔═██╗  ╚════██║
//                                                            ██║    ██║  ██║ ███████╗ ██║  ██╗ ███████║
//                                                            ╚═╝    ╚═╝  ╚═╝ ╚══════╝ ╚═╝  ╚═╝ ╚══════╝
//                                                                       Created by Dominik Wilkowski
// @desc     Talk Design systems
// @author   Dominik Wilkowski
// @website  https://github.com/dominikwilkowski/talks
// @issues   https://github.com/dominikwilkowski/talks/issues
//--------------------------------------------------------------------------------------------------------------------------------------------------------------


//--------------------------------------------------------------------------------------------------------------------------------------------------------------
// External dependencies
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
var Fs = require('fs');


//--------------------------------------------------------------------------------------------------------------------------------------------------------------
// Grunt module
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
module.exports = function(grunt) {

	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Dependencies
	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	grunt.loadNpmTasks('grunt-contrib-connect');
	grunt.loadNpmTasks('grunt-contrib-uglify');
	grunt.loadNpmTasks('grunt-contrib-concat');
	grunt.loadNpmTasks('grunt-contrib-watch');
	// grunt.loadNpmTasks('grunt-contrib-clean');
	grunt.loadNpmTasks('grunt-contrib-stylus');
	// grunt.loadNpmTasks('grunt-contrib-copy');
	grunt.loadNpmTasks('grunt-lintspaces');
	grunt.loadNpmTasks('grunt-grunticon');
	grunt.loadNpmTasks('grunt-wakeup');
	grunt.loadNpmTasks('grunt-font');


	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Grunt tasks
	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	grunt.initConfig({


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// STYLUS
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		stylus: {
			compile: {
				options: {
					use: [
						require('autoprefixer-stylus'),
					],
				},
				files: {
					'assets/css/site.min.css': 'assets/stylus/site.styl',
				},
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Concat files
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		concat: {
			compile: {
				src: [
					'assets/js/*jquery*.js',
					'assets/js/site.min.js',
				],
				dest: 'assets/js/site.min.js',
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// UGLIFY
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		uglify: {
			options: {
				mangle: false,
				report: 'gzip',
			},

			compile: {
				files: {
					'assets/js/site.min.js': [
						'assets/js/*.js',
						'!assets/js/site.min.js',
						'!assets/js/*jquery*.js',
					],
				},
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// GRUNTICON
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		grunticon: {
			compile: {
				options: {
					datasvgcss: 'symbols.data.svg.css',
					datapngcss: 'symbols.data.png.css',
					urlpngcss: 'symbols.fallback.css',
					cssprefix: '.sitesymbol-',
					enhanceSVG: true,
					customselectors: {
						'header-bg': ['.header .headerline'],
					},
					pngpath: '../img',
				},

				files: [{
					expand: true,
					cwd: 'assets/svg',
					src: ['*.svg'],
					dest: 'assets/css',
				}],
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// LINT SPACES
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		lintspaces: {
			all: {
				options: {
					editorconfig: '../.editorconfig',
					ignores: [
						'js-comments',
						'c-comments',
						'java-comments',
						'as-comments',
						'xml-comments',
						'html-comments',
						'python-comments',
						'ruby-comments',
						'applescript-comments',
					],
				},
				src: [
					'assets/**/*.js',
					'assets/**/*.styl',
					'assets/**/*.css',
					'**/*.html',

					'!node_modules/**/*.*',
					'!**/*.svg',
					'!**/*.css',
					'!**/*reveal*',
					'!**/*.min.*',
					'!**/notes-server/*',
					'!Gruntfile.js',
				],
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Banner
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		font: {
			options: {
				space: false,
				colors: ['white', 'gray'],
			},

			title: {
				text: '| talks',
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Wakeup
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		wakeup: {
			wakeme: {
				options: {
					randomize: true,
				},
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// Watch
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		watch: {
			js: {
				files: [
					'assets/js/**/*.js',
					'!assets/js/site.min.js',
				],
				tasks: [
					'_buildJS',
					'wakeup',
				],
			},

			css: {
				files: [
					'assets/stylus/**/*.styl',
					'assets/stylus/**/*.css',
					'assets/stylus/**/site.min.css',
				],
				tasks: [
					'_buildCSS',
					'wakeup',
				],
			},

			svg: {
				files: [
					'assets/svg/**/*.svg',
				],
				tasks: [
					'_buildSVG',
					'wakeup',
				],
			},
		},


		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		// server
		//----------------------------------------------------------------------------------------------------------------------------------------------------------
		connect: {
			server: {
				options: {
					open: false,
					hostname: '127.0.0.1',
					port: 1337,
				},
			},
		},

	});



	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Private tasks
	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	grunt.registerTask('_build', [
		// 'lintspaces',
		'stylus',
		'uglify',
		'concat',
		'grunticon',
	]);

	grunt.registerTask('_buildJS', [
		// 'lintspaces',
		'uglify',
		'concat',
	]);

	grunt.registerTask('_buildCSS', [
		// 'lintspaces',
		'stylus',
	]);

	grunt.registerTask('_buildSVG', [
		// 'lintspaces',
		'grunticon',
	]);


	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Public tasks
	//------------------------------------------------------------------------------------------------------------------------------------------------------------
	grunt.registerTask('default', [
		'font',
		'_build',
		'connect',
		'wakeup',
		'watch',
	]);

};